<!DOCTYPE html>
<html lang="id" class="transition-colors duration-300">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR & Barcode Studio Pro v4</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            bg: '#0f172a',
                            panel: '#1e293b',
                            input: '#334155',
                            border: '#475569'
                        }
                    },
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script type="text/javascript" src="https://unpkg.com/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://unpkg.com/@zxing/library@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Outfit', sans-serif;
        }
        
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #475569;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.6);
        }
        .dark .glass-panel {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            font-weight: 600;
            border: none;
            border-radius: 0.75rem;
            padding: 0.75rem 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .btn-primary:hover {
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
            transform: translateY(-2px);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #1f2937;
            border: 1px solid #e5e7eb;
            font-weight: 600;
            border-radius: 0.75rem;
            padding: 0.75rem 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .dark .btn-secondary {
            background: #334155;
            color: #f1f5f9;
            border-color: #475569;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        .dark .btn-secondary:hover {
            background: #475569;
        }

        .input-icon-wrap {
            position: relative;
            display: flex;
            align-items: center;
        }

        .input-icon-wrap i {
            position: absolute;
            left: 1rem;
            color: #9ca3af;
            font-size: 0.875rem;
            pointer-events: none;
            transition: color 0.3s ease;
        }

        .dark .input-icon-wrap i {
            color: #64748b;
        }

        .input-std {
            width: 100%;
            padding-left: 2.5rem;
            padding-right: 1rem;
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            font-size: 0.875rem;
            color: #1f2937;
            transition: all 0.3s ease;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            outline: none;
        }

        .dark .input-std {
            background-color: #334155;
            border-color: #475569;
            color: #f1f5f9;
        }

        .input-std:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1), 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .input-std::placeholder {
            color: #9ca3af;
        }

        .dark .input-std::placeholder {
            color: #64748b;
        }

        .tab-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-size: 0.875rem;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 1px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .tab-btn.active {
            background: #dbeafe;
            color: #1e40af;
            border-color: #93c5fd;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);
        }

        .dark .tab-btn.active {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            border-color: rgba(59, 130, 246, 0.4);
        }

        .tab-btn.inactive {
            color: #6b7280;
            background: transparent;
            border-color: transparent;
        }

        .dark .tab-btn.inactive {
            color: #9ca3af;
        }

        .tab-btn.inactive:hover {
            background: #f3f4f6;
        }

        .dark .tab-btn.inactive:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .dot-style-btn {
            padding: 0.5rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            background: white;
            color: #4b5563;
            font-size: 0.75rem;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dark .dot-style-btn {
            background: #334155;
            border-color: #475569;
            color: #cbd5e1;
        }

        .dot-style-btn:hover {
            border-color: #3b82f6;
            background: #f0f9ff;
            color: #1e40af;
        }

        .dark .dot-style-btn:hover {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
            color: #60a5fa;
        }

        .dot-style-btn.active {
            background: #dbeafe;
            border-color: #3b82f6;
            color: #1e40af;
            font-weight: 600;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .dark .dot-style-btn.active {
            background: rgba(59, 130, 246, 0.2);
            border-color: #60a5fa;
            color: #60a5fa;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .color-picker-wrapper {
            position: relative;
            width: 3rem;
            height: 3rem;
            border-radius: 0.75rem;
            border: 2px solid #e5e7eb;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .dark .color-picker-wrapper {
            border-color: #475569;
        }

        .color-picker-wrapper:hover {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .color-picker-input {
            width: 100%;
            height: 100%;
            border: 0;
            padding: 0;
            cursor: pointer;
        }

        .blob {
            position: absolute;
            filter: blur(80px);
            z-index: 0;
            opacity: 0.4;
            animation: float 10s infinite ease-in-out;
        }

        .blob-1 {
            top: -10%;
            left: -10%;
            width: 400px;
            height: 400px;
            background: #60a5fa;
            animation-delay: 0s;
        }

        .blob-2 {
            bottom: -10%;
            right: -10%;
            width: 400px;
            height: 400px;
            background: #3b82f6;
            animation-delay: 2s;
        }
        
        @keyframes float {
            0%, 100% {
                transform: translate(0, 0) scale(1);
            }
            50% {
                transform: translate(30px, -30px) scale(1.05);
            }
        }

        #video-preview {
            width: 100%;
            border-radius: 1rem;
            transform: scaleX(-1);
        }

        .scanner-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 250px;
            height: 250px;
            border: 3px solid #60a5fa;
            border-radius: 1rem;
            box-shadow: 0 0 0 4000px rgba(0, 0, 0, 0.6);
            z-index: 10;
        }

        .section-title {
            font-size: 0.875rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #6b7280;
            margin-bottom: 1rem;
        }

        .dark .section-title {
            color: #9ca3af;
        }

        .label-text {
            font-size: 0.75rem;
            font-weight: 600;
            color: #6b7280;
            margin-bottom: 0.5rem;
            display: block;
        }

        .dark .label-text {
            color: #9ca3af;
        }

        .divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, #e5e7eb, transparent);
            margin: 1.5rem 0;
        }

        .dark .divider {
            background: linear-gradient(90deg, transparent, #475569, transparent);
        }

        .card-panel {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 1rem;
            padding: 1.25rem;
            transition: all 0.3s ease;
        }

        .dark .card-panel {
            background: #334155;
            border-color: #475569;
        }

        .card-panel:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);
        }

        .dark .card-panel:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);
        }

        .success-badge {
            background: #dbeafe;
            color: #1e40af;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .dark .success-badge {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }

        .error-badge {
            background: #fee2e2;
            color: #991b1b;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .dark .error-badge {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }

        @media (max-width: 1024px) {
            .left-panel {
                position: absolute;
                left: 0;
                top: 0;
                height: 100%;
                width: 100%;
                z-index: 50;
                transform: translateX(0);
                transition: transform 0.3s ease;
                box-shadow: -4px 0 12px rgba(0, 0, 0, 0.15);
            }

            .left-panel.hidden-mobile {
                transform: translateX(-100%);
            }
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden bg-gray-50 dark:bg-slate-900 text-gray-800 dark:text-gray-100 transition-colors duration-300">

    <div class="fixed inset-0 overflow-hidden pointer-events-none z-0">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
    </div>

    <!-- Navbar -->
    <nav class="glass-panel border-b border-gray-200 dark:border-slate-700 px-6 py-4 flex justify-between items-center z-50 relative">
        <div class="flex items-center gap-4">
            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 text-white flex items-center justify-center shadow-lg shadow-blue-500/30">
                <i class="fa-solid fa-qrcode text-xl"></i>
            </div>
            <div>
                <h1 class="text-2xl font-bold text-gray-900 dark:text-white">QR Studio</h1>
                <p class="text-xs text-gray-500 dark:text-gray-400 font-medium">Creator & Scanner Suite</p>
            </div>
        </div>
        
        <div class="flex items-center gap-3">
            <button onclick="toggleTheme()" class="w-10 h-10 rounded-lg bg-gray-100 dark:bg-slate-800 hover:bg-gray-200 dark:hover:bg-slate-700 flex items-center justify-center transition-all text-gray-700 dark:text-amber-400 shadow-sm">
                <i id="theme-icon" class="fa-solid fa-moon text-lg"></i>
            </button>
            <div class="text-xs font-bold text-white bg-gradient-to-r from-blue-600 to-blue-700 px-3 py-1.5 rounded-lg hidden sm:block shadow-md">
                v4.1
            </div>
        </div>
    </nav>

    <!-- Main Layout -->
    <div class="flex flex-1 overflow-hidden relative z-10">
        
        <!-- LEFT PANEL -->
        <div class="left-panel w-full lg:w-[420px] bg-white dark:bg-slate-800 border-r border-gray-200 dark:border-slate-700 flex flex-col overflow-y-auto shadow-xl dark:shadow-2xl z-20 transition-transform duration-300">
            
            <!-- Mobile Header -->
            <div class="lg:hidden flex justify-between items-center p-5 border-b border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-800">
                <h2 class="font-bold text-gray-800 dark:text-white">Settings</h2>
                <button onclick="closeMobilePanel()" class="w-8 h-8 flex items-center justify-center rounded-lg bg-gray-100 dark:bg-slate-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-slate-600 transition-colors">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>

            <!-- Tabs -->
            <div class="grid grid-cols-2 p-5 gap-3 sticky top-0 bg-white dark:bg-slate-800 backdrop-blur-sm z-30 border-b border-gray-200 dark:border-slate-700">
                <button onclick="switchTab('generator')" id="btn-generator" class="tab-btn active">
                    <i class="fa-solid fa-wand-magic-sparkles text-sm"></i> 
                    <span>Generator</span>
                </button>
                <button onclick="switchTab('scanner')" id="btn-scanner" class="tab-btn inactive">
                    <i class="fa-solid fa-camera text-sm"></i> 
                    <span>Scanner</span>
                </button>
            </div>

            <div class="p-6 space-y-6 pb-20 overflow-y-auto">
                
                <!-- GENERATOR TAB -->
                <div id="tab-generator" class="space-y-6">
                    
                    <!-- Mode Selector -->
                    <div>
                        <div class="flex items-center justify-between mb-3">
                            <span class="section-title">Mode</span>
                            <div class="inline-flex bg-gray-100 dark:bg-slate-700 rounded-lg p-1 gap-1">
                                <button onclick="setMode('qr')" id="btn-sub-qr" class="px-3 py-1.5 text-xs font-bold rounded-md bg-white dark:bg-slate-600 text-blue-600 dark:text-blue-400 shadow-sm transition-all hover:shadow-md">
                                    QR
                                </button>
                                <button onclick="setMode('barcode')" id="btn-sub-barcode" class="px-3 py-1.5 text-xs font-bold rounded-md text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300 transition-all">
                                    Barcode
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- QR Type Selector -->
                    <div id="qr-types-container">
                        <span class="label-text">Type QR Code</span>
                        <div class="input-icon-wrap">
                            <i class="fa-solid fa-layer-group"></i>
                            <select id="qr-type" onchange="updateUI()" class="input-std cursor-pointer appearance-none pr-10">
                                <option value="url">Website / URL Link</option>
                                <option value="text">Plain Text</option>
                                <option value="wifi">WiFi Network</option>
                                <option value="whatsapp">WhatsApp Chat</option>
                                <option value="email">Email Message</option>
                            </select>
                            <i class="fa-solid fa-chevron-down text-xs absolute right-3 pointer-events-none text-gray-400 dark:text-gray-500"></i>
                        </div>
                    </div>

                    <!-- Barcode Type Selector -->
                    <div id="barcode-types-container" class="hidden">
                        <span class="label-text">Barcode Format</span>
                        <div class="input-icon-wrap">
                            <i class="fa-solid fa-barcode"></i>
                            <select id="barcode-format" onchange="generateBarcode()" class="input-std cursor-pointer appearance-none pr-10">
                                <option value="CODE128">Code 128 (Universal)</option>
                                <option value="EAN13">EAN-13 (Retail)</option>
                                <option value="UPC">UPC (US Standard)</option>
                                <option value="CODE39">Code 39</option>
                            </select>
                            <i class="fa-solid fa-chevron-down text-xs absolute right-3 pointer-events-none text-gray-400 dark:text-gray-500"></i>
                        </div>
                    </div>

                    <div class="divider"></div>

                    <!-- Dynamic Inputs -->
                    <div class="space-y-4">
                        <!-- URL Input -->
                        <div id="inp-grp-url" class="inp-group">
                            <span class="label-text">Target URL</span>
                            <div class="input-icon-wrap">
                                <i class="fa-solid fa-link"></i>
                                <input type="text" id="val-url" placeholder="https://example.com" class="input-std" oninput="updatePreview()">
                            </div>
                        </div>
                        
                        <!-- Text Input -->
                        <div id="inp-grp-text" class="inp-group hidden">
                            <span class="label-text">Text Content</span>
                            <div class="input-icon-wrap">
                                <i class="fa-solid fa-align-left"></i>
                                <textarea id="val-text" rows="3" placeholder="Enter your text..." class="input-std pl-10 py-3 resize-none" oninput="updatePreview()"></textarea>
                            </div>
                        </div>

                        <!-- WiFi Inputs -->
                        <div id="inp-grp-wifi" class="inp-group hidden space-y-4">
                            <div>
                                <span class="label-text">WiFi Name (SSID)</span>
                                <div class="input-icon-wrap">
                                    <i class="fa-solid fa-wifi"></i>
                                    <input type="text" id="wifi-ssid" placeholder="Network name" class="input-std" oninput="updatePreview()">
                                </div>
                            </div>
                            <div>
                                <span class="label-text">WiFi Password</span>
                                <div class="input-icon-wrap">
                                    <i class="fa-solid fa-key"></i>
                                    <input type="text" id="wifi-pass" placeholder="Password" class="input-std" oninput="updatePreview()">
                                </div>
                            </div>
                            <div class="flex gap-3">
                                <div class="flex-1">
                                    <span class="label-text">Security</span>
                                    <select id="wifi-enc" class="input-std cursor-pointer appearance-none pr-8" onchange="updatePreview()">
                                        <option value="WPA">WPA/WPA2</option>
                                        <option value="WEP">WEP</option>
                                        <option value="nopass">Open</option>
                                    </select>
                                </div>
                                <div class="flex-1">
                                    <span class="label-text">Options</span>
                                    <div class="h-10 flex items-center px-3 bg-gray-50 dark:bg-slate-700 border border-gray-200 dark:border-slate-600 rounded-lg">
                                        <input type="checkbox" id="wifi-hidden" class="accent-blue-500 cursor-pointer" onchange="updatePreview()">
                                        <label for="wifi-hidden" class="text-xs font-medium ml-2 cursor-pointer">Hidden</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- WhatsApp Inputs -->
                        <div id="inp-grp-wa" class="inp-group hidden space-y-4">
                            <div>
                                <span class="label-text">Phone Number</span>
                                <div class="input-icon-wrap">
                                    <i class="fa-solid fa-phone"></i>
                                    <input type="number" id="wa-num" placeholder="628123456789" class="input-std" oninput="updatePreview()">
                                </div>
                            </div>
                            <div>
                                <span class="label-text">Message</span>
                                <div class="input-icon-wrap">
                                    <i class="fa-solid fa-comment-dots"></i>
                                    <input type="text" id="wa-msg" placeholder="Hello, I want to..." class="input-std" oninput="updatePreview()">
                                </div>
                            </div>
                        </div>

                        <!-- Email Inputs -->
                        <div id="inp-grp-email" class="inp-group hidden space-y-4">
                            <div>
                                <span class="label-text">Email Address</span>
                                <div class="input-icon-wrap">
                                    <i class="fa-solid fa-envelope"></i>
                                    <input type="email" id="email-addr" placeholder="recipient@email.com" class="input-std" oninput="updatePreview()">
                                </div>
                            </div>
                            <div>
                                <span class="label-text">Subject</span>
                                <div class="input-icon-wrap">
                                    <i class="fa-solid fa-heading"></i>
                                    <input type="text" id="email-sub" placeholder="Email subject" class="input-std" oninput="updatePreview()">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="divider"></div>

                    <!-- Styling Section -->
                    <div id="section-style">
                        <h3 class="section-title mb-4">Personalization</h3>

                        <!-- QR Styles -->
                        <div id="style-qr-controls" class="space-y-6">
                            
                            <!-- Dot Style -->
                            <div>
                                <span class="label-text">Dot Pattern</span>
                                <div class="grid grid-cols-3 gap-2">
                                    <button onclick="setQrDots('square')" data-type="square" class="dot-style-btn">Squares</button>
                                    <button onclick="setQrDots('dots')" data-type="dots" class="dot-style-btn active">Dots</button>
                                    <button onclick="setQrDots('rounded')" data-type="rounded" class="dot-style-btn">Rounded</button>
                                    <button onclick="setQrDots('classy')" data-type="classy" class="dot-style-btn">Classy</button>
                                    <button onclick="setQrDots('classy-rounded')" data-type="classy-rounded" class="dot-style-btn">C-Round</button>
                                    <button onclick="setQrDots('extra-rounded')" data-type="extra-rounded" class="dot-style-btn">X-Round</button>
                                </div>
                            </div>

                            <!-- Colors -->
                            <div>
                                <span class="label-text">Colors</span>
                                <div class="card-panel space-y-4">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm">Primary Color</span>
                                        <div class="color-picker-wrapper">
                                            <input type="color" id="color-1" value="#3b82f6" class="color-picker-input" onchange="updatePreview()">
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm">Gradient Color</span>
                                        <div class="color-picker-wrapper">
                                            <input type="color" id="color-2" value="#2563eb" class="color-picker-input" onchange="updatePreview()">
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm">Background</span>
                                        <div class="color-picker-wrapper">
                                            <input type="color" id="bg-color" value="#ffffff" class="color-picker-input" onchange="updatePreview()">
                                        </div>
                                    </div>
                                    <div>
                                        <span class="label-text">Gradient Mode</span>
                                        <select id="gradient-type" class="input-std cursor-pointer appearance-none" onchange="updatePreview()">
                                            <option value="linear">Linear Gradient</option>
                                            <option value="radial">Radial Gradient</option>
                                            <option value="none">Solid Color</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Logo Upload -->
                            <div>
                                <span class="label-text">Logo (Optional)</span>
                                <label class="flex flex-col items-center gap-3 w-full p-4 bg-gray-50 dark:bg-slate-700 border-2 border-dashed border-gray-300 dark:border-slate-600 rounded-lg cursor-pointer hover:border-blue-500 dark:hover:border-blue-400 transition-colors group">
                                    <div class="w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400 group-hover:scale-110 transition-transform">
                                        <i class="fa-solid fa-cloud-arrow-up text-lg"></i>
                                    </div>
                                    <div class="text-center">
                                        <p class="text-xs font-bold text-gray-700 dark:text-gray-300">Click to upload</p>
                                        <p class="text-[10px] text-gray-500 dark:text-gray-400">PNG/JPG (Max 2MB)</p>
                                    </div>
                                    <input type="file" id="logo-input" accept="image/*" class="hidden" onchange="handleLogoUpload()">
                                </label>
                            </div>
                        </div>

                        <!-- Barcode Styles -->
                        <div id="style-barcode-controls" class="hidden space-y-4">
                            <div class="card-panel space-y-4">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-medium">Barcode Color</span>
                                    <div class="color-picker-wrapper">
                                        <input type="color" id="barcode-color" value="#000000" class="color-picker-input" onchange="updatePreview()">
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between mb-2">
                                        <span class="text-sm font-medium">Line Width</span>
                                        <span class="text-xs font-bold text-blue-600 dark:text-blue-400" id="bw-val">2</span>
                                    </div>
                                    <input type="range" id="bar-width" min="1" max="4" value="2" class="w-full h-2 bg-gray-200 dark:bg-slate-600 rounded-lg appearance-none cursor-pointer accent-blue-500" oninput="updatePreview(); document.getElementById('bw-val').innerText = this.value;">
                                </div>
                                <div>
                                    <div class="flex justify-between mb-2">
                                        <span class="text-sm font-medium">Height</span>
                                        <span class="text-xs font-bold text-blue-600 dark:text-blue-400" id="bh-val">80</span>
                                    </div>
                                    <input type="range" id="bar-height" min="30" max="150" value="80" class="w-full h-2 bg-gray-200 dark:bg-slate-600 rounded-lg appearance-none cursor-pointer accent-blue-500" oninput="updatePreview(); document.getElementById('bh-val').innerText = this.value;">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Mobile Download -->
                    <div class="lg:hidden fixed bottom-0 left-0 right-0 p-5 bg-gradient-to-t from-white dark:from-slate-800 via-white dark:via-slate-800 to-transparent">
                        <button onclick="downloadCode()" class="btn-primary w-full text-lg py-4">
                            <i class="fa-solid fa-download"></i> Download PNG
                        </button>
                    </div>
                </div>

                <!-- SCANNER TAB -->
                <div id="tab-scanner" class="hidden space-y-6">
                    <div class="card-panel text-center">
                        <div class="w-16 h-16 mx-auto bg-blue-100 dark:bg-blue-900/30 rounded-xl flex items-center justify-center mb-4">
                            <i class="fa-solid fa-camera text-2xl text-blue-600 dark:text-blue-400"></i>
                        </div>
                        <h3 class="font-bold text-gray-900 dark:text-white mb-1">Scan QR/Barcode</h3>
                        <p class="text-xs text-gray-600 dark:text-gray-400 mb-6">Point your camera at the code to scan</p>
                        
                        <div class="space-y-3">
                            <button onclick="startCamera()" class="btn-primary w-full">
                                <i class="fa-solid fa-video"></i> Open Camera
                            </button>
                            <button onclick="document.getElementById('scan-image-upload').click()" class="btn-secondary w-full">
                                <i class="fa-solid fa-image"></i> Upload Image
                            </button>
                            <input type="file" id="scan-image-upload" accept="image/*" class="hidden" onchange="scanImageFile()">
                        </div>
                    </div>

                    <!-- Camera Container -->
                    <div id="camera-container" class="hidden relative rounded-2xl overflow-hidden bg-black shadow-2xl">
                        <video id="video-preview" playsinline class="w-full h-full"></video>
                        <div class="scanner-overlay"></div>
                        <button onclick="stopCamera()" class="absolute bottom-6 left-1/2 -translate-x-1/2 bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg font-bold text-sm shadow-lg transition-colors">
                            <i class="fa-solid fa-stop"></i> Stop
                        </button>
                    </div>
                    
                    <!-- Scan Result -->
                    <div id="scan-result-container" class="hidden">
                        <div class="card-panel bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800 border-2">
                            <div class="flex justify-between items-start mb-3">
                                <span class="success-badge">Success</span>
                                <button onclick="copyScanResult()" class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors" title="Copy">
                                    <i class="fa-regular fa-copy text-lg"></i>
                                </button>
                            </div>
                            <p id="scan-result-text" class="font-mono text-sm text-gray-800 dark:text-gray-200 break-all mb-4"></p>
                            <div class="flex gap-2">
                                <button onclick="useScanResultAsQR()" class="btn-primary flex-1 text-sm">
                                    <i class="fa-solid fa-pencil"></i> Edit
                                </button>
                                <button onclick="clearScanResult()" class="btn-secondary flex-1 text-sm">
                                    <i class="fa-solid fa-xmark"></i> Close
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Scan Error -->
                    <div id="scan-error-container" class="hidden">
                        <div class="card-panel bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 border-2 text-center">
                            <span class="error-badge">Error</span>
                            <p class="text-sm text-red-600 dark:text-red-400 mt-2" id="scan-error-text">Error message</p>
                            <button onclick="clearScanError()" class="text-xs text-red-500 dark:text-red-400 underline mt-3">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT PANEL: Preview -->
        <div class="flex-1 relative flex flex-col items-center justify-center p-8 hidden lg:flex bg-gradient-to-br from-gray-50 to-gray-100 dark:from-slate-900 dark:to-slate-800">
            
            <div class="glass-panel p-12 rounded-3xl shadow-2xl relative z-20 flex flex-col items-center transform hover:scale-[1.01] transition-transform duration-500">
                
                <div id="canvas-container" class="bg-white dark:bg-slate-700 rounded-2xl overflow-hidden flex items-center justify-center min-w-[320px] min-h-[320px] shadow-inner">
                </div>
                
                <div class="mt-10 flex gap-4">
                    <button onclick="downloadCode()" class="btn-primary text-base shadow-lg shadow-blue-500/30 hover:shadow-blue-500/50">
                        <i class="fa-solid fa-cloud-arrow-down"></i> Download PNG
                    </button>
                </div>
                
                <p class="absolute bottom-6 text-[10px] text-gray-400 dark:text-gray-500 font-mono tracking-widest uppercase opacity-50">
                    High Resolution â€¢ Ready to Print
                </p>
            </div>
        </div>

        <!-- Mobile Preview Button -->
        <button onclick="toggleMobilePreview()" class="lg:hidden fixed bottom-24 right-6 w-14 h-14 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 text-white shadow-lg shadow-blue-500/40 flex items-center justify-center z-40 hover:shadow-blue-500/60 active:scale-90 transition-all">
            <i class="fa-solid fa-eye text-xl"></i>
        </button>
    </div>

    <script>
        function toggleTheme() {
            const html = document.documentElement;
            const icon = document.getElementById('theme-icon');
            
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                localStorage.setItem('theme', 'light');
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            } else {
                html.classList.add('dark');
                localStorage.setItem('theme', 'dark');
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            }
        }

        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
            document.getElementById('theme-icon').classList.remove('fa-moon');
            document.getElementById('theme-icon').classList.add('fa-sun');
        }

        let mode = 'qr';
        let qrCode;
        let uploadedLogo = null;
        let selectedDotType = 'dots';
        let videoStream = null;
        let codeReader = null;
        let scanningActive = false;
        let scanIntervalId = null;

        window.addEventListener('load', () => {
            if (window.ZXing) {
                const { BrowserMultiFormatReader } = ZXing;
                codeReader = new BrowserMultiFormatReader();
            }

            qrCode = new QRCodeStyling({
                width: 300,
                height: 300,
                type: 'svg',
                data: 'https://example.com',
                image: '',
                dotsOptions: { color: '#3b82f6', type: 'dots' },
                backgroundOptions: { color: '#ffffff' },
                imageOptions: { crossOrigin: 'anonymous', margin: 10 }
            });
            
            const container = document.getElementById('canvas-container');
            if (container) {
                container.innerHTML = '';
                qrCode.append(container);
            }
            
            updateUI();
        });

        function switchTab(tab) {
            document.getElementById('tab-generator').classList.add('hidden');
            document.getElementById('tab-scanner').classList.add('hidden');
            document.getElementById('btn-generator').classList.remove('active');
            document.getElementById('btn-generator').classList.add('inactive');
            document.getElementById('btn-scanner').classList.remove('active');
            document.getElementById('btn-scanner').classList.add('inactive');

            if (tab === 'generator') {
                document.getElementById('tab-generator').classList.remove('hidden');
                document.getElementById('btn-generator').classList.add('active');
                document.getElementById('btn-generator').classList.remove('inactive');
                stopCamera();
            } else {
                document.getElementById('tab-scanner').classList.remove('hidden');
                document.getElementById('btn-scanner').classList.add('active');
                document.getElementById('btn-scanner').classList.remove('inactive');
            }
        }

        function setMode(newMode) {
            mode = newMode;
            const btnQr = document.getElementById('btn-sub-qr');
            const btnBar = document.getElementById('btn-sub-barcode');
            
            if (mode === 'qr') {
                btnQr.className = 'px-3 py-1.5 text-xs font-bold rounded-md bg-white dark:bg-slate-600 text-blue-600 dark:text-blue-400 shadow-sm transition-all hover:shadow-md';
                btnBar.className = 'px-3 py-1.5 text-xs font-bold rounded-md text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300 transition-all';
                
                document.getElementById('qr-types-container').classList.remove('hidden');
                document.getElementById('barcode-types-container').classList.add('hidden');
                document.getElementById('style-qr-controls').classList.remove('hidden');
                document.getElementById('style-barcode-controls').classList.add('hidden');
                updateUI();
            } else {
                btnBar.className = 'px-3 py-1.5 text-xs font-bold rounded-md bg-white dark:bg-slate-600 text-blue-600 dark:text-blue-400 shadow-sm transition-all hover:shadow-md';
                btnQr.className = 'px-3 py-1.5 text-xs font-bold rounded-md text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300 transition-all';

                document.getElementById('qr-types-container').classList.add('hidden');
                document.getElementById('barcode-types-container').classList.remove('hidden');
                document.getElementById('style-qr-controls').classList.add('hidden');
                document.getElementById('style-barcode-controls').classList.remove('hidden');
                
                document.querySelectorAll('.inp-group').forEach(el => el.classList.add('hidden'));
                document.getElementById('inp-grp-text').classList.remove('hidden');
                generateBarcode();
            }
        }

        function updateUI() {
            if (mode === 'barcode') return;
            const type = document.getElementById('qr-type').value;
            
            document.querySelectorAll('.inp-group').forEach(el => el.classList.add('hidden'));
            
            if (type === 'url') document.getElementById('inp-grp-url').classList.remove('hidden');
            else if (type === 'text') document.getElementById('inp-grp-text').classList.remove('hidden');
            else if (type === 'wifi') document.getElementById('inp-grp-wifi').classList.remove('hidden');
            else if (type === 'whatsapp') document.getElementById('inp-grp-wa').classList.remove('hidden');
            else if (type === 'email') document.getElementById('inp-grp-email').classList.remove('hidden');
            
            updatePreview();
        }

        function setQrDots(type) {
            selectedDotType = type;
            document.querySelectorAll('.dot-style-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.type === type) {
                    btn.classList.add('active');
                }
            });
            updatePreview();
        }

        function handleLogoUpload() {
            const file = document.getElementById('logo-input').files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    uploadedLogo = e.target.result;
                    updatePreview();
                };
                reader.readAsDataURL(file);
            }
        }

        function getQRData() {
            const type = document.getElementById('qr-type').value;
            if (type === 'url') return document.getElementById('val-url').value || 'https://example.com';
            if (type === 'text') return document.getElementById('val-text').value || 'Hello World';
            if (type === 'wifi') {
                const ssid = document.getElementById('wifi-ssid').value || 'MyWiFi';
                const pass = document.getElementById('wifi-pass').value || '';
                const enc = document.getElementById('wifi-enc').value;
                const hidden = document.getElementById('wifi-hidden').checked ? 'true' : 'false';
                return 'WIFI:S:' + ssid + ';T:' + enc + ';P:' + pass + ';H:' + hidden + ';;';
            }
            if (type === 'whatsapp') {
                const num = document.getElementById('wa-num').value || '628123';
                const msg = document.getElementById('wa-msg').value || '';
                return 'https://wa.me/' + num + '?text=' + encodeURIComponent(msg);
            }
            if (type === 'email') {
                const addr = document.getElementById('email-addr').value || 'mail@example.com';
                const sub = document.getElementById('email-sub').value || '';
                return 'mailto:' + addr + '?subject=' + encodeURIComponent(sub);
            }
            return 'Error';
        }

        function updatePreview() {
            if (mode === 'barcode') {
                generateBarcode();
                return;
            }
            
            const col1 = document.getElementById('color-1').value;
            const col2 = document.getElementById('color-2').value;
            const bg = document.getElementById('bg-color').value;
            const gradType = document.getElementById('gradient-type').value;

            let dotsOptions = { type: selectedDotType, color: col1 };
            if (gradType !== 'none') {
                dotsOptions.gradient = {
                    type: gradType,
                    rotation: 45,
                    colorStops: [{ offset: 0, color: col1 }, { offset: 1, color: col2 }]
                };
            }

            qrCode.update({
                data: getQRData(),
                image: uploadedLogo,
                dotsOptions: dotsOptions,
                backgroundOptions: { color: bg },
                cornersSquareOptions: { type: selectedDotType === 'square' ? 'square' : 'extra-rounded', color: col1 },
                cornersDotOptions: { type: selectedDotType === 'square' ? 'square' : 'dot', color: col1 }
            });
        }

        function generateBarcode() {
            const container = document.getElementById('canvas-container');
            container.innerHTML = '<svg id="barcode-svg"></svg>';
            
            const format = document.getElementById('barcode-format').value;
            let val = document.getElementById('val-text').value;
            
            if (!val) val = (format === 'EAN13') ? '1234567890128' : (format === 'UPC' ? '123456789012' : 'EXAMPLE123');
            
            try {
                JsBarcode('#barcode-svg', val, {
                    format: format,
                    lineColor: document.getElementById('barcode-color').value,
                    width: parseInt(document.getElementById('bar-width').value),
                    height: parseInt(document.getElementById('bar-height').value),
                    displayValue: true,
                    background: '#ffffff',
                    margin: 10
                });
            } catch (e) {
                container.innerHTML = '<p class="text-red-500 text-xs font-bold p-4">Invalid Data for ' + format + '</p>';
            }
        }

        async function downloadCode() {
            if (mode === 'qr') {
                qrCode.download({ name: 'qr_studio_pro', extension: 'png' });
            } else {
                try {
                    const svg = document.querySelector('#barcode-svg');
                    const serializer = new XMLSerializer();
                    const svgStr = serializer.serializeToString(svg);
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const img = new Image();
                    
                    const svgRect = svg.getBoundingClientRect();
                    canvas.width = svgRect.width + 20;
                    canvas.height = svgRect.height + 20;
                    
                    img.onload = () => {
                        ctx.fillStyle = '#ffffff';
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                        ctx.drawImage(img, 10, 10);
                        const link = document.createElement('a');
                        link.download = 'barcode_studio_pro.png';
                        link.href = canvas.toDataURL('image/png');
                        link.click();
                    };
                    img.src = 'data:image/svg+xml;base64,' + btoa(svgStr);
                } catch (e) {
                    alert('Error generating download');
                }
            }
        }

        async function startCamera() {
            try {
                document.getElementById('camera-container').classList.remove('hidden');
                document.getElementById('scan-result-container').classList.add('hidden');
                document.getElementById('scan-error-container').classList.add('hidden');
                
                const video = document.getElementById('video-preview');
                videoStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                video.srcObject = videoStream;
                video.play();
                scanningActive = true;
                
                scanIntervalId = setInterval(async () => {
                    if (!scanningActive) return;
                    try {
                        const canvas = document.createElement('canvas');
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(video, 0, 0);
                        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                        const result = codeReader.decodeFromImageData(imageData);
                        if (result) {
                            scanningActive = false;
                            clearInterval(scanIntervalId);
                            showResult(result.getText());
                            stopCamera();
                        }
                    } catch (e) {
                    }
                }, 500);
            } catch (e) {
                document.getElementById('scan-error-container').classList.remove('hidden');
                document.getElementById('scan-error-text').innerText = 'Camera Access Denied: ' + e.message;
            }
        }

        function stopCamera() {
            scanningActive = false;
            if (videoStream) videoStream.getTracks().forEach(t => t.stop());
            clearInterval(scanIntervalId);
            document.getElementById('camera-container').classList.add('hidden');
        }
        
        async function scanImageFile() {
            const file = document.getElementById('scan-image-upload').files[0];
            if (!file) return;
            
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                canvas.width = img.width;
                canvas.height = img.height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0);
                try {
                    const result = codeReader.decodeFromImageData(ctx.getImageData(0, 0, canvas.width, canvas.height));
                    if (result) {
                        showResult(result.getText());
                    } else {
                        document.getElementById('scan-error-container').classList.remove('hidden');
                        document.getElementById('scan-error-text').innerText = 'No QR/Barcode found in image';
                    }
                } catch (e) {
                    document.getElementById('scan-error-container').classList.remove('hidden');
                    document.getElementById('scan-error-text').innerText = 'Scan failed: ' + e.message;
                }
            };
            const r = new FileReader();
            r.onload = e => img.src = e.target.result;
            r.readAsDataURL(file);
        }

        function showResult(txt) {
            document.getElementById('scan-result-container').classList.remove('hidden');
            document.getElementById('scan-error-container').classList.add('hidden');
            document.getElementById('scan-result-text').innerText = txt;
        }
        
        function clearScanResult() {
            document.getElementById('scan-result-container').classList.add('hidden');
            document.getElementById('scan-image-upload').value = '';
        }

        function clearScanError() {
            document.getElementById('scan-error-container').classList.add('hidden');
        }
        
        function copyScanResult() {
            navigator.clipboard.writeText(document.getElementById('scan-result-text').innerText).then(() => {
                alert('Copied to clipboard!');
            });
        }

        function useScanResultAsQR() {
            const txt = document.getElementById('scan-result-text').innerText;
            switchTab('generator');
            if (txt.includes('http')) {
                document.getElementById('qr-type').value = 'url';
                document.getElementById('val-url').value = txt;
            } else if (txt.includes('WIFI:')) {
                document.getElementById('qr-type').value = 'wifi';
            } else if (txt.includes('mailto:')) {
                document.getElementById('qr-type').value = 'email';
            } else if (txt.includes('wa.me')) {
                document.getElementById('qr-type').value = 'whatsapp';
            } else {
                document.getElementById('qr-type').value = 'text';
                document.getElementById('val-text').value = txt;
            }
            updateUI();
        }

        function closeMobilePanel() {
            document.querySelector('.left-panel').classList.add('hidden-mobile');
        }

        function toggleMobilePreview() {
            const lp = document.querySelector('.left-panel');
            lp.classList.contains('hidden-mobile') ? lp.classList.remove('hidden-mobile') : lp.classList.add('hidden-mobile');
        }
    </script>
</body>
</html>
